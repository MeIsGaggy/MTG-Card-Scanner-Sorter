:root {
  --gap: 12px;
  --panel-radius: 12px;
  --pad: 10px;
  --border: #2a2d34;
  --bg: #0f1115;
  --panel: #151821;
  --panel-head: #11141b;

  --ok-bg: #0e2e15;
  --ok-bd: #1c4a29;
  --ok-fg: #9be5a8;

  --wr-bg: #2e250e;
  --wr-bd: #4a3a1c;
  --wr-fg: #f3d17a;

  --bd-bg: #2e0e0e;
  --bd-bd: #4a1c1c;
  --bd-fg: #f4a7a7;

  --fs: clamp(11px, 1.2vw, 16px);
  --h2fs: clamp(12px, 1.4vw, 18px);
  --pillfs: clamp(10px, 1.0vw, 14px);
}

* { box-sizing: border-box; }

html, body { height: 100%; overflow: hidden; }

body {
  background: var(--bg);
  color: #e4e6eb;
  font-family: system-ui, Segoe UI, Roboto, Ubuntu, Arial, sans-serif;
  margin: 0;
}

.grid {
  display: grid;
  height: 100vh;
  width: 100vw;
  padding: var(--gap);
  gap: var(--gap);
  grid-template-columns: 1.6fr 1fr 1fr;
  grid-template-rows: 1fr .9fr;
  grid-template-areas:
    "live crop info1"
    "status cmp  info2";
}

body.ci-collapsed .grid {
  grid-template-columns: 1.6fr 1fr 1fr;
  grid-template-rows: 1fr .9fr;
  grid-template-areas:
    "live crop info2"
    "status cmp  info2";
}

@media (max-width: 1200px) {
  .grid {
    grid-template-columns: 1.2fr 1fr;
    grid-template-rows: 1fr .9fr .9fr .9fr .9fr;
    grid-template-areas:
      "live info1"
      "crop info1"
      "cmp  info2"
      "status status";
  }
  body.ci-collapsed .grid {
    grid-template-columns: 1.2fr 1fr;
    grid-template-rows: 1fr .9fr .9fr .9fr;
    grid-template-areas:
      "live info2"
      "crop info2"
      "cmp  info2"
      "status status";
  }
}

@media (max-width: 780px) {
  .grid {
    grid-template-columns: 1fr;
    grid-template-rows: .9fr .8fr .8fr .7fr .7fr;
    grid-template-areas:
      "live"
      "crop"
      "cmp"
      "info1"
      "info2";
  }
  #status { display: none; }
  body.ci-collapsed .grid {
    grid-template-columns: 1fr;
    grid-template-rows: .9fr .8fr .8fr .7fr;
    grid-template-areas:
      "live"
      "crop"
      "cmp"
      "info2";
  }
}

.panel {
  border: 1px solid var(--border);
  border-radius: var(--panel-radius);
  background: var(--panel);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  min-width: 0;
  min-height: 0;
}

.panel h2 {
  margin: 0;
  padding: 8px var(--pad);
  font-size: var(--h2fs);
  border-bottom: 1px solid #262a33;
  background: var(--panel-head);
}

.panel > .content {
  flex: 1 1 auto;
  min-height: 0;
  display: flex;
  flex-direction: column;
  gap: var(--pad);
}

.main   { grid-area: live; }
.crop   { grid-area: crop; }
.info1  { grid-area: info1; }
.info2  { grid-area: info2; }
.status-panel { grid-area: status; }
.cmp    { grid-area: cmp; }

.media-wrap {
  flex: 1;
  min-height: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.media-wrap img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}

/* Manual crop overlay */
.manual-crop-svg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 2;
}
.manual-crop-svg polygon {
  fill: rgba(68, 255, 136, 0.1);
  stroke: #3ce27b;
  stroke-width: 0.55;
  pointer-events: none;
}
.manual-handle {
  fill: #ffb347;
  stroke: #0a0a0a;
  stroke-width: 0.35;
  pointer-events: auto;
  cursor: grab;
}
.manual-handle:active { cursor: grabbing; }
.manual-hint {
  position: absolute;
  top: 8px;
  right: 8px;
  left: auto;
  bottom: auto;
  background: rgba(0, 0, 0, 0.65);
  color: #efe;
  padding: 6px 8px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 11px;
  line-height: 1.2;
  pointer-events: none;
  z-index: 3;
}
.manual-hint__actions {
  display: flex;
  align-items: center;
  gap: 8px;
}
.manual-hint button { pointer-events: auto; }
.manual-saved {
  background: rgba(60, 226, 123, 0.18);
  color: #c8ffde;
  padding: 2px 8px;
  border-radius: 999px;
  font-weight: 600;
  border: 1px solid rgba(60, 226, 123, 0.35);
}
.manual-saved.error {
  background: rgba(255, 110, 110, 0.25);
  border-color: rgba(255, 110, 110, 0.45);
  color: #ffd7d7;
}

.row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px 10px;
  align-items: center;
}

.pill {
  display: inline-flex;
  text-align: center;
  align-items: center;
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid var(--border);
  font-size: var(--pillfs);
  line-height: 1.1;
}

.ok   { background: var(--ok-bg); color: var(--ok-fg); border-color: var(--ok-bd); }
.warn { background: var(--wr-bg); color: var(--wr-fg); border-color: var(--wr-bd); }
.bad  { background: var(--bd-bg); color: var(--bd-fg); border-color: var(--bd-bd); }
.ci { display:flex; gap:16px; }
.ci-img img { width:260px; height:auto; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,.35); }
.ci-body { display:flex; flex-direction:column; gap:6px; }
.ci-title { font-size:1.4rem; font-weight:700; display:flex; align-items:center; gap:8px; }
.ci-mana { font-family:monospace; font-weight:600; opacity:.8; }
.ci-type, .ci-meta { opacity:.85; }
.ci-oracle { white-space:pre-wrap; line-height:1.35; }
.ci-prices { display:flex; gap:12px; flex-wrap:wrap; margin-top:6px; opacity:.95; }

button {
  background: #2a2f3b;
  color: #e8ecf1;
  border: 1px solid #3a4050;
  border-radius: 10px;
  padding: 10px 14px;
  cursor: pointer;
  font-size: var(--pillfs);
  min-height: 44px;
}
button.btn-mini {
  min-height: 28px;
  padding: 4px 10px;
  font-size: 12px;
  border-radius: 12px;
}
button:disabled { opacity: .5; cursor: not-allowed; }
button.danger { background: #3a2430; border-color: #5a3242; }

.cardbox > * { min-width: 0; }
.panel.info1 > .content { overflow: auto; }

/* make the controls bar allow wrapping */
.prn-mainbar { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }

/* full-width E-STOP */
.btn-estop {
  flex: 1 0 100%;          /* take the whole row */
  height: 56px;            /* bigger target */
  font-weight: 700;
  font-size: 32px;
  border-radius: 8px;
  border-style: dashed;
  background: #d40b00;
  border-color: #000000;
  color: #000;
}
.btn-estop:hover { filter: brightness(0.95); }


/* Thinner panels for space */
.panel.status-panel .content { max-height: 130px; overflow: hidden; }
/* Make the comparison panel content behave like a big canvas */
.panel.cmp > .content {
  display: flex;
  flex-direction: column;
  gap: 12px;
  min-height: 0;          /* <- critical so the child can grow */
}

/* The toolbar row at top of cmp stays natural height; the image area gets the rest */
.panel.cmp .media-wrap {
  flex: 1 1 auto;         /* <- take all remaining height */
  min-height: 0;
  align-items: center;
  justify-content: center;
}
.panel.info2 > .content {
  display: flex;
  flex-direction: column;
  gap: 10px;
  min-height: 0;            /* important: allow children to grow */
}
/* Printer controls bar (now inside Comparison) */
.prn-mainbar { display:flex; gap:8px; align-items:center; padding: 8px 12px; }
.prn-mainbar .spacer{ flex:1; }
#btnStartRun{ font-weight:600; }

/* Card info layout */
.cardbox {
  display: grid;
  grid-template-columns: minmax(240px, 1.1fr) 1.4fr;
  grid-template-areas: "left right";
  column-gap: 14px;
  row-gap: 8px;
}
.cardbox .left  { grid-area: left;  display: flex; flex-direction: column; align-items: center; justify-content: flex-start; gap: 10px; }
.cardbox .right { grid-area: right; display: flex; flex-direction: column; gap: 10px; padding-right: 12px; align-items: flex-start; }

.cardbox .prices-below {
  margin-top: 10px; align-self: center; text-align: center; width: fit-content; max-width: 100%; padding: 0 6px;
}
.cardbox .prices-below .prow { display: flex; flex-direction: column; gap: 6px; align-items: center; }
.cardbox .prices-below .phead { margin-bottom: 6px; }

@media (max-width: 1200px) {
  .cardbox { grid-template-columns: 1fr; grid-template-areas: "left" "right"; }
  .cardbox .right { padding-right: 0; }
}

.scry-half, .review-half {
  min-height: 0; display: flex; flex-direction: column; gap: 10px; overflow: auto;
}

.revhead { display: flex; align-items: center; gap: 10px; justify-content: space-between; }

.revlist { display: flex; flex-direction: column; gap: 8px; overflow: auto; }

#revList {
  flex: 1 1 auto;
  min-height: 0;
  overflow: auto;
}

.panel.crop #ocr { padding: var(--pad); padding-top: 6px; }

.revitem {
  display: flex; align-items: center; gap: 10px; padding: 8px;
  border: 1px solid #2a2f3b; border-radius: 10px; cursor: pointer;
}
.revitem .thumb {
  width: 64px; height: 90px; object-fit: cover; border-radius: 6px; border: 1px solid #2a3140;
}
.revitem .thumb.thumb-missing,
.hcard .thumb.thumb-missing {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  border: 1px dashed #3a4050;
  background:
    repeating-linear-gradient(135deg, rgba(74,84,104,.3), rgba(74,84,104,.3) 6px, transparent 6px, transparent 12px),
    #151821;
  color: #7f8799;
}
.revitem .thumb.thumb-missing {
  width: 64px;
  height: 90px;
}
.revitem-actions {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin-top: 4px;
}

.subline, .textbox, .links, .meta { overflow-wrap: anywhere; word-break: normal; }
.links { white-space: normal; }

.version-chip {
  position: fixed; right: 12px; bottom: 12px;
  background: rgba(0,0,0,.75); color: #fff;
  padding: 6px 10px; border-radius: 10px; font: 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  z-index: 9999; user-select: none;
}
.version-chip a { color: inherit; text-decoration: none; }

/* Export modal checklist */
.mm-checklist {
  display: grid; grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 8px 14px; max-height: 50vh; overflow: auto;
  border: 1px solid #242b36; border-radius: 10px; padding: 8px; background: #0f1115;
}
.mm-check { display: flex; align-items: center; gap: 8px; font-size: 14px; }
.mm-check input { width: 16px; height: 16px; }

/* Card info atoms */
#cardinfo { display: flex; flex-direction: column; gap: 12px; }
.cardbox { display: grid; grid-template-columns: 1.1fr 1.4fr; gap: 14px; }
.cardbox .left { display: flex; flex-direction: column; align-items: center; justify-content: flex-start; gap: 10px; }
.cardbox .art {
  width: 100%; height: auto; border-radius: 14px; box-shadow: 0 6px 24px rgba(0,0,0,.45);
}
.cardbox .right { display: flex; flex-direction: column; gap: 10px; overflow: auto; min-height: 0; }

.title { display: flex; align-items: flex-start; justify-content: space-between; gap: 10px; }
.name { font-size: clamp(18px, 2.2vw, 28px); font-weight: 700; line-height: 1.1; }
.mana { opacity: .9; font-family: ui-monospace, monospace; }

.subline { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
.tag {
  display: inline-flex;
  align-items: center;
  font-size: 12px;
  color: inherit;
  background: transparent;
}
.seticon {
  width: 26px; height: 26px; display: inline-block; padding: 2px; border-radius: 6px;
  background: #9c9c9c; opacity: .95; vertical-align: middle; margin-left: 6px; object-fit: contain; box-shadow: none;
}

.textbox { background: linear-gradient(180deg, #141824, #0f121a); border: 1px solid #242a36; border-radius: 12px; padding: 10px; }
.textbox .oracle { font-size: 13px; line-height: 1.35; }
.textbox .flavor { font-size: 12px; opacity: .8; font-style: italic; margin-top: 6px; }

.keywords { margin-top: 6px; display: flex; gap: 6px; flex-wrap: wrap; }

.prices .phead { font-weight: 600; margin-bottom: 4px; }
.prices .prow { display: flex; flex-wrap: wrap; gap: 6px; }

.meta { display: flex; flex-wrap: wrap; gap: 6px; }

.legal {
  display: grid; grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 6px; font-size: 12px;
}
.legal .leg { background: #141824; border: 1px solid #252a37; border-radius: 10px; padding: 6px 8px; display: flex; justify-content: space-between; }
.legal .ok { color: #9be5a8; }
.legal .no { color: #f4a7a7; opacity: .9; }

.hidden { display: none !important; }

.input {
  width: 100%;
  border-radius: 0.75rem;
  background-color: #131721;
  border: 1px solid #2c3242;
  color: #f5f7fa;
  padding: 0.55rem 0.85rem;
  outline: none;
  transition: border-color 0.15s ease, box-shadow 0.15s ease;
}
.input::placeholder { color: #9aa3af; opacity: .75; }
.input:focus {
  box-shadow: 0 0 0 2px rgba(59,130,246,.35);
  border-color: #3b82f6;
}

/* Generic modal styles */
.mm-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.55); z-index: 70; }
.mm-modal {
  position: fixed; z-index: 80; width: 720px; max-width: calc(100vw - 40px);
  background: #121418; border: 1px solid #222832; border-radius: 14px; box-shadow: 0 12px 40px rgba(0,0,0,.6);
  top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; flex-direction: column; overflow: hidden;
}
.mm-modal__header, .mm-modal__footer { padding: 12px 14px; display: flex; align-items: center; gap: 10px; background: #0e1014; }
.mm-modal__body { padding: 14px; }
.mm-title { font-size: 16px; font-weight: 600; color: #e5e7eb; }

.mm-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; }
.mm-field { display: flex; flex-direction: column; gap: 6px; color: #b7c0cd; }
.mm-input { background: #181c22; color: #e5e7eb; border: 1px solid #242b36; border-radius: 10px; padding: 8px 10px; outline: none; }
.mm-row { display: flex; gap: 8px; }

.btn { padding: 8px 12px; border-radius: 999px; border: 1px solid #242b36; background: #1a1f27; color: #e5e7eb; }
.btn:hover { background: #222834; }
.btn-ghost { background: transparent; }
.btn-ghost-custom { background: #0d6e59; }
.btn-primary { background: #2c7be5; border-color: #2c7be5; color: #fff; }
.spacer { flex: 1; }
.btn-expand-scry { background: #0d6e59; border-color: #2c7be5; color: #fff; }
.modal { position: fixed; inset: 0; z-index: 80; display: none; }
.modal.show { display: block; }
.modal .backdrop { display: none; }
.modal .card {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  width: 720px; max-width: calc(100vw - 40px); background: #121418; border: 1px solid #222832;
  border-radius: 14px; box-shadow: 0 12px 40px rgba(0,0,0,.6); display: flex; flex-direction: column; overflow: hidden; z-index: 81;
}
.modal .head, .modal .body { padding: 12px 14px; }
.modal .head { background: #0e1014; display: flex; align-items: center; justify-content: space-between; }

.reprocess-card {
  max-width: 960px;
  width: 94vw;
}
.reprocess-card .body { min-height: 180px; }
.reprocess-card .foot {
  padding: 12px 14px 18px;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}
.reprocess-card .foot button { min-width: 150px; }
.reprocess-status {
  font-weight: 600;
  margin-bottom: 10px;
  opacity: .85;
}
.reprocess-cols {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 14px;
}
.reproc-col {
  border: 1px solid #2a3140;
  border-radius: 12px;
  padding: 12px;
  background: #0f1115;
}
.reproc-col h3 {
  margin: 0 0 8px;
  font-size: 1rem;
}
.reproc-field {
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 10px;
  font-size: 0.9rem;
  margin-bottom: 4px;
}
.reproc-field span {
  opacity: .7;
  font-size: 0.85rem;
}
.reproc-field.sub {
  margin-top: -6px;
  font-size: 0.8rem;
  opacity: .75;
}
.reproc-field em { font-style: italic; }
.reproc-img {
  width: 100%;
  border-radius: 8px;
  border: 1px solid #2a3140;
  margin-top: 8px;
  display: block;
}
.reproc-img.hidden { display: none; }
.reproc-reasons {
  margin: 10px 0 0;
  padding-left: 16px;
  font-size: 0.85rem;
  min-height: 30px;
}
.reproc-reasons li { margin-bottom: 4px; }
.reproc-reasons .muted {
  list-style: none;
  padding-left: 0;
  opacity: .6;
}
.progress-block {
  margin: 8px 0 12px;
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.progress-block span {
  font-size: 0.85rem;
  opacity: .8;
}
.progress {
  width: 100%;
  height: 10px;
  border-radius: 999px;
  background: #1d2330;
  border: 1px solid #2a3140;
  overflow: hidden;
}
.progress > div {
  height: 100%;
  width: 0%;
  background: #2c7be5;
  transition: width 0.2s ease;
}
.progress.alt > div {
  background: #f0ad4e;
}
.reproc-batch-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
  max-height: 60vh;
  overflow: auto;
}
.reproc-batch-item {
  border: 1px solid #2a3140;
  border-radius: 12px;
  padding: 12px;
  background: #0f1115;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.reproc-batch-item h4 {
  margin: 0;
  font-size: 1rem;
}
.reproc-batch-columns {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 10px;
}
.reproc-batch-actions {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  flex-wrap: wrap;
}

.consolebox {
  background: #0f1115;
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 8px;
  margin: 0;
  font: 12px/1.35 ui-monospace, Menlo, Consolas, monospace;
  max-height: 220px;
  overflow-y: auto;
  overflow-x: hidden;
  white-space: pre-wrap;
  word-break: break-word;
  overflow-wrap: anywhere;
}
/* Console tag severity colors and layout fixes */
.consolebox .tag {
  display: inline-flex;
  align-items: center;
  padding: 0 6px;
  margin: 0 6px;
  font-weight: 700;
  border-radius: 8px;
  border: 1px solid transparent;
  color: #f4f4f4 !important;
}
.consolebox .tag-ok   { color: #9be5a8 !important; border-color: rgba(77,227,139,.6); background: rgba(12,50,30,.6); }
.consolebox .tag-info { color: #9bb8ff !important; border-color: rgba(126,181,255,.6); background: rgba(24,42,86,.6); }
.consolebox .tag-debug{ color: #c5cedb !important; border-color: rgba(140,160,185,.6); background: rgba(32,40,52,.6); }
.consolebox .tag-warn { color: #f5d27a !important; border-color: rgba(245,192,106,.6); background: rgba(92,70,28,.6); }
.consolebox .tag-err  { color: #ff9f9f !important; border-color: rgba(255,138,138,.6); background: rgba(94,24,32,.6); }

/* Robust scroll area for console */
#status .console-wrap {
  display:flex;
  flex-direction:column;
  gap:8px;
  flex:0 0 auto;
  min-height:0;
  max-height:320px;
}
#status #consoleBox {
  flex:0 0 auto;
  min-height:140px;
  max-height:280px;
  overflow:auto;
  position:relative;
  z-index:0;
}
#status .console-wrap .toolbar {
  position: sticky;
  bottom: 0;
  background: var(--panel);
  padding-top: 4px;
  z-index:1;
}


.consolebox .t { color: #a9adba; }
.consolebox .g { color: #cdd3df; }

.panel.crop .media-wrap { aspect-ratio: 63 / 88; }

#live, #card, #cmpimg {
  width: 100%; height: 100%; max-height: 100%; object-fit: contain; display: block;
}

@media (max-width: 1200px) { .cardbox { grid-template-columns: 1fr; } }

@media (max-height: 520px) and (min-width: 640px) {
  :root { --gap: 8px; --pad: 8px; --h2fs: 14px; --pillfs: 13px; }
  .grid {
    height: 100vh; width: 100vw;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
    grid-template-areas: "live info" "crop cmp";
  }
  #status { display: none !important; }
  .panel h2 { padding: 6px var(--pad); }
  .media-wrap { padding: 4px; }
  button { min-height: 44px; padding: 8px 12px; }
  .cardbox { grid-template-columns: 1fr; gap: 10px; }
}

.mm-help { font-size: 12px; opacity: .8; }
.mm-tab { padding: 6px 10px; border: 1px solid #242b36; border-radius: 999px; background: #151821; cursor: pointer; }
.mm-tab.active { background: #2c7be5; border-color: #2c7be5; color: #fff; }

#status { display: flex; flex-direction: column; }
#status > .content { flex: 0 0 auto; }

#status .console-wrap {
  flex: 1 1 auto; min-height: 0; display: flex; flex-direction: column; gap: 8px;
  padding: var(--pad); padding-top: 0;
}
#status .console-header { display: flex; justify-content: space-between; align-items: center; }
#status #consoleBox { flex: 1 1 auto; min-height: 0; }

.pillbar {
  padding: 8px 12px; background: #10141b;
  border: 1px solid var(--border); border-radius: 12px; gap: 8px 10px;
}

.toolbar {
  padding: 8px 12px; background: #10141b;
  border: 1px solid var(--border); border-radius: 12px;
  display: flex; flex-wrap: wrap; gap: 10px;
}

.btn-pill { border-radius: 999px; }

.panel .content > .row { margin-bottom: 4px; }

.mm-section { border-top: 1px solid #242b36; margin-top: 16px; padding-top: 12px; }
.mm-section:first-child { border-top: 0; margin-top: 0; padding-top: 0; }
.mm-section h3 {
  margin: 0 0 8px; font-weight: 600; font-size: 14px; letter-spacing: .2px; color: #e6e8ee; opacity: .95;
}
#settings-modal .mm-modal__body { position: relative; }
.mm-section h3.sticky {
  position: sticky; top: 0; background: #121418; padding: 6px 0; z-index: 5; border-bottom: 1px solid #1e2430;
}

#editModal .body .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
#editModal .body input {
  padding: 10px 12px; border: 1px solid #263043; background: #121722; color: #E6E8EE;
  border-radius: 10px; outline: none; font-size: 14px; box-shadow: inset 0 1px 0 rgba(255,255,255,.03);
  transition: border-color .15s ease, box-shadow .15s ease, background-color .15s ease;
}
#editModal .body input:hover  { border-color: #2E3A52; }
#editModal .body input:focus  { border-color: #6D8CFF; box-shadow: 0 0 0 3px rgba(109,140,255,.25); }
#editModal .body input::placeholder { color: #A7AFBD; opacity: .7; }
#editModal .body button { padding: 8px 12px; border-radius:999px; border:1px solid #242b36; background:#1a1f27; color:#e5e7eb; }
#editModal .body button:hover { background: #222834; }
#editModal #eiApply { background: #2c7be5; border-color: #2c7be5; color: #fff; }
#editModal #eiSearch { background: #1a1f27; }
#editModal #eiResults {
  margin-top: 12px;
  max-height: min(60vh, 520px);
  overflow-y: auto;
  padding-right: 6px;
}
#editModal #eiResults::-webkit-scrollbar {
  width: 10px;
}
#editModal #eiResults::-webkit-scrollbar-thumb {
  background: #2a3344;
  border-radius: 6px;
}
#editModal #eiResults::-webkit-scrollbar-track {
  background: #11151d;
}

#editModal .head .close {
  width: 32px; height: 32px; display:inline-flex; align-items:center; justify-content:center;
  border-radius:10px; border:1px solid #242b36; background:#1a1f27; color:#e5e7eb;
}
#editModal .head .close:hover { background:#222834; }

.panel.info1 { --info-pad: 14px; }
.panel.info1 > h2 { padding: 0 var(--info-pad); margin-bottom: 6px; }
.panel.info1 > .content { padding: var(--info-pad); overflow: auto; }
.panel.info1 .panel-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 var(--info-pad);
  margin-bottom: 6px;
}
body.ci-collapsed #cardinfo-panel { display: none; }
body.ci-collapsed #cardinfo-restore { display: inline-flex; }

#cardinfo-restore {
  position: fixed;
  right: 18px;
  top: 14px;
  z-index: 200;
  display: none;
}
.cardbox .left  { padding-left: 4px; }
.cardbox .right { padding-right: 8px; }



/* ---- Settings inputs polish ---- */
.mm-field > .mm-input,
.mm-input {
  background: #181c22;
  color: #e5e7eb;
  border: 1px solid #242b36;
  border-radius: 9999px;
  padding: 10px 14px;
  line-height: 1.2;
  height: 36px;
  width: 100%;
  box-sizing: border-box;
}
.mm-input::placeholder { color: #9aa3af; opacity: .7; }
.mm-input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59,130,246,.2); }

/* number input spinners hidden for cleaner look */
.mm-input[type="number"]::-webkit-outer-spin-button,
.mm-input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.mm-input[type="number"] { -moz-appearance: textfield; appearance: textfield; }

/* select reset */
select.mm-input { appearance: none; -webkit-appearance: none; -moz-appearance: none; padding-right: 28px; background-image: none; }

/* ---- Settings form facelift (CSS-only, safe) ---- */
#settings-modal input[type="text"],
#settings-modal input[type="number"],
#settings-modal input[type="search"],
#settings-modal input[type="url"],
#settings-modal input[type="tel"],
#settings-modal input[type="email"],
#settings-modal select,
#settings-modal textarea {
  background: #181c22;
  color: #e5e7eb;
  border: 1px solid #242b36;
  border-radius: 9999px;           /* pill */
  padding: 10px 14px;
  line-height: 1.2;
  height: 36px;                    /* text/select inputs */
  width: 100%;
  box-sizing: border-box;
}

#settings-modal textarea {
  height: auto;                    /* let textareas grow */
  min-height: 90px;
  border-radius: 16px;             /* softer corners for multi-line */
}

#settings-modal input::placeholder,
#settings-modal textarea::placeholder { color: #9aa3af; opacity: .7; }

#settings-modal input:focus,
#settings-modal select:focus,
#settings-modal textarea:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 2px rgba(59,130,246,.2);
}

/* Remove number spinners + satisfy linter */
#settings-modal input[type="number"] { -moz-appearance: textfield; appearance: textfield; }
#settings-modal input[type="number"]::-webkit-outer-spin-button,
#settings-modal input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

/* Normalize <select> arrow across browsers (and fix the 'appearance' warning) */
#settings-modal select { appearance: none; -webkit-appearance: none; -moz-appearance: none; padding-right: 28px; }

/* ===== Printer Controls D-pad ===== */
.pc-wrap { display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
.pc-pad {
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
  width: fit-content;
  margin: 0 auto;
}
.pc-middle {
  display:grid;
  grid-template-columns: repeat(3, 64px);
  gap:8px;
  align-items:center;
  justify-items:center;
}
.pc-arrow, .pc-homexy {
  width:64px;
  height:48px;
  font-size:18px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.pc-right { display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
.pc-zcol { display:flex; flex-direction:column; gap:8px; }
.pc-z { width:80px; height:48px; }
.pc-home-col { display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:8px; min-width:220px; }
.pc-steps { margin-top:10px; display:flex; flex-wrap:wrap; gap:6px; }
.pc-step { border-radius:12px; padding:6px 12px; background:#1b1f2a; border:1px solid #2a3140; cursor:pointer; font-size:13px; }
.pc-step.active { background:#3b82f6; border-color:#3b82f6; color:#fff; }

/* ===== Printer Controls: Speed ===== */
.pc-speed-wrap { margin-top: 8px; display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.pc-label { opacity:.9; font-size:13px; }
.pc-speed-chips { display:flex; gap:6px; flex-wrap:wrap; }
.pc-speed { border-radius:12px; padding:6px 12px; background:#1b1f2a; border:1px solid #2a3140; cursor:pointer; font-size:13px; }
.pc-speed.active { background:#06b6d4; border-color:#06b6d4; color:#001; }
.pc-speed-input { width:120px; }

/* Ensure modal footer wraps so E-STOP is full width when needed */
.mm-modal__footer { flex-wrap: wrap; }
#printer-estop { flex: 1 0 100%; }



/* ===== All History (grid) ===== */
.history-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 8px;
  width: 100%;
  align-content: start;
}
.history-grid-inline {
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
}
.hcard {
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding: 6px;
  background: var(--card, #111);
  border: 1px solid var(--line, #333);
  border-radius: 10px;
  cursor: pointer;
  min-height: 0;
}
.hcard .thumb {
  width: 100%;
  aspect-ratio: 5/7;
  object-fit: cover;
  border-radius: 6px;
  display: block;
  height: 120px;
}
.hcard .row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 4px;
}
.hcard .title {
  font-weight: 600;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-size: 0.85rem;
}
.hcard .meta {
  display: flex;
  flex-direction: column;
  gap: 1px;
  font-size: .7rem;
  opacity: .9;
}
.hcard .meta span {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.hcard .pill {
  font-size: .75rem;
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid currentColor;
}
.hcard .pill.ok { color: var(--ok, #26c281); }
.hcard .pill.bad { color: var(--bad, #ff596d); }
.hcard .pill.warn { color: var(--warn, #f0ad4e); border-style: dashed; }
.mm-modal.history-popup {
  position: fixed;
  top: 20px;
  bottom: 20px;
  left: 50%;
  right: auto;
  transform: translateX(-50%);
  width: min(1200px, calc(100vw - 40px));
  max-width: calc(100vw - 40px);
  height: calc(100vh - 40px);
  max-height: calc(100vh - 40px);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  z-index: 100;
  border-radius: 14px;
}
.mm-modal.history-popup::before,
.mm-modal.history-popup::after { content: none; }
.mm-modal.history-popup .mm-modal__body {
  padding: 16px;
  overflow-y: auto;
  flex: 1 1 auto;
  min-height: 0;
}
.mm-modal.history-popup .mm-modal__header {
  position: sticky;
  top: 0;
  z-index: 2;
  background: #0e1014;
}
.mm-modal.history-popup .history-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 8px;
  padding-right: 4px;
}
